{"version":3,"names":[],"mappings":"","sources":["WiPubSub.js"],"sourcesContent":["/**\n * @file\n * @copyright\n * @license\n *\n */\n/* eslint valid-jsdoc: [\"error\", {\"requireReturnDescription\": false}] */\n\n// import User from './User';\n// import Project from './Project';\n// import Instance from './Instance';\nvar mqtt = require('mqtt')\nvar bunyan = require('bunyan')\n\nvar log = bunyan.createLogger({name:'WiPubSub'})\n// var mqttClient\n\n/**\n * WiPubSub encapsulates the functionality to create various API wrapper objects.\n */\nclass WiPubSub {\n   /**\n    * Create a new WiPubSub.\n    */\n   constructor(host = 'whatsit-pubsub', protocol = 'mqtt', port = '1883') {\n      this.__url = `${protocol}://${host}`\n      this._this = this\n      this.onConnect = this.onConnect.bind(this);\n      this.onError = this.onError.bind(this);\n   }\n\n   connect () {\n      this.mqttClient = mqtt.connect(this.__url)\n      this.mqttClient.on('connect', this.onConnect);\n      this.mqttClient.on('error', this.onError);\n   }\n\n   isConnected () {\n      return this.mqttClient.connected;\n   }\n\n   onConnect () {\n      log.info('onConnect')\n      this.mqttClient.publish(this.topic, this.message)\n      this.resolve()\n   }\n\n   onError (error) {\n      log.info(`onError: ${error}`)\n      this.reject(error)\n   }\n\n   publish (topic, message) {\n      log.info('publish')\n      return new Promise((resolve, reject) => {\n         this.resolve = resolve\n         this.reject= reject\n         this.topic = topic\n         this.message = message\n         this.connect()\n      })\n   }\n}\n\nmodule.exports = WiPubSub;\n"],"file":"WiPubSub.js"}