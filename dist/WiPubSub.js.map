{"version":3,"sources":["node_modules/browser-pack/_prelude.js","lib/WiPubSub.js"],"names":[],"mappings":"AAAA;;;;;;;ACAA;;;;;;AAMA;;AAEA;AACA;AACA;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,SAAS,QAAQ,QAAR,CAAb;;AAEA,IAAI,MAAM,OAAO,YAAP,CAAoB,EAAC,MAAK,UAAN,EAApB,CAAV;AACA;;AAEA;;;;IAGM,Q;AACH;;;AAGA,uBAAuE;AAAA,UAA3D,IAA2D,uEAApD,gBAAoD;AAAA,UAAlC,QAAkC,uEAAvB,MAAuB;AAAA,UAAf,IAAe,uEAAR,MAAQ;;AAAA;;AACpE,WAAK,KAAL,GAAgB,QAAhB,WAA8B,IAA9B;AACA,WAAK,KAAL,GAAa,IAAb;AACA,WAAK,SAAL,GAAiB,KAAK,SAAL,CAAe,IAAf,CAAoB,IAApB,CAAjB;AACA,WAAK,OAAL,GAAe,KAAK,OAAL,CAAa,IAAb,CAAkB,IAAlB,CAAf;AACF;;;;gCAEU;AACR,cAAK,UAAL,GAAkB,KAAK,OAAL,CAAa,KAAK,KAAlB,CAAlB;AACA,cAAK,UAAL,CAAgB,EAAhB,CAAmB,SAAnB,EAA8B,KAAK,SAAnC;AACA,cAAK,UAAL,CAAgB,EAAhB,CAAmB,OAAnB,EAA4B,KAAK,OAAjC;AACF;;;oCAEc;AACZ,gBAAO,KAAK,UAAL,CAAgB,SAAvB;AACF;;;kCAEY;AACV,aAAI,IAAJ,CAAS,WAAT;AACA,cAAK,UAAL,CAAgB,OAAhB,CAAwB,KAAK,KAA7B,EAAoC,KAAK,OAAzC;AACA,cAAK,OAAL;AACF;;;8BAEQ,K,EAAO;AACb,aAAI,IAAJ,eAAqB,KAArB;AACA,cAAK,MAAL,CAAY,KAAZ;AACF;;;8BAEQ,K,EAAO,O,EAAS;AAAA;;AACtB,aAAI,IAAJ,CAAS,SAAT;AACA,gBAAO,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAqB;AACrC,kBAAK,OAAL,GAAe,OAAf;AACA,kBAAK,MAAL,GAAa,MAAb;AACA,kBAAK,KAAL,GAAa,KAAb;AACA,kBAAK,OAAL,GAAe,OAAf;AACA,kBAAK,OAAL;AACF,UANM,CAAP;AAOF;;;;;;AAGJ,OAAO,OAAP,GAAiB,QAAjB","file":"WiPubSub.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * @file\n * @copyright\n * @license\n *\n */\n/* eslint valid-jsdoc: [\"error\", {\"requireReturnDescription\": false}] */\n\n// import User from './User';\n// import Project from './Project';\n// import Instance from './Instance';\nvar mqtt = require('mqtt')\nvar bunyan = require('bunyan')\n\nvar log = bunyan.createLogger({name:'WiPubSub'})\n// var mqttClient\n\n/**\n * WiPubSub encapsulates the functionality to create various API wrapper objects.\n */\nclass WiPubSub {\n   /**\n    * Create a new WiPubSub.\n    */\n   constructor(host = 'whatsit-pubsub', protocol = 'mqtt', port = '1883') {\n      this.__url = `${protocol}://${host}`\n      this._this = this\n      this.onConnect = this.onConnect.bind(this);\n      this.onError = this.onError.bind(this);\n   }\n\n   connect () {\n      this.mqttClient = mqtt.connect(this.__url)\n      this.mqttClient.on('connect', this.onConnect);\n      this.mqttClient.on('error', this.onError);\n   }\n\n   isConnected () {\n      return this.mqttClient.connected;\n   }\n\n   onConnect () {\n      log.info('onConnect')\n      this.mqttClient.publish(this.topic, this.message)\n      this.resolve()\n   }\n\n   onError (error) {\n      log.info(`onError: ${error}`)\n      this.reject(error)\n   }\n\n   publish (topic, message) {\n      log.info('publish')\n      return new Promise((resolve, reject) => {\n         this.resolve = resolve\n         this.reject= reject\n         this.topic = topic\n         this.message = message\n         this.connect()\n      })\n   }\n}\n\nmodule.exports = WiPubSub;\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJsaWIvV2lQdWJTdWIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7QUNBQTs7Ozs7O0FBTUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSSxPQUFPLFFBQVEsTUFBUixDQUFYO0FBQ0EsSUFBSSxTQUFTLFFBQVEsUUFBUixDQUFiOztBQUVBLElBQUksTUFBTSxPQUFPLFlBQVAsQ0FBb0IsRUFBQyxNQUFLLFVBQU4sRUFBcEIsQ0FBVjtBQUNBOztBQUVBOzs7O0lBR00sUTtBQUNIOzs7QUFHQSx1QkFBdUU7QUFBQSxVQUEzRCxJQUEyRCx1RUFBcEQsZ0JBQW9EO0FBQUEsVUFBbEMsUUFBa0MsdUVBQXZCLE1BQXVCO0FBQUEsVUFBZixJQUFlLHVFQUFSLE1BQVE7O0FBQUE7O0FBQ3BFLFdBQUssS0FBTCxHQUFnQixRQUFoQixXQUE4QixJQUE5QjtBQUNBLFdBQUssS0FBTCxHQUFhLElBQWI7QUFDQSxXQUFLLFNBQUwsR0FBaUIsS0FBSyxTQUFMLENBQWUsSUFBZixDQUFvQixJQUFwQixDQUFqQjtBQUNBLFdBQUssT0FBTCxHQUFlLEtBQUssT0FBTCxDQUFhLElBQWIsQ0FBa0IsSUFBbEIsQ0FBZjtBQUNGOzs7O2dDQUVVO0FBQ1IsY0FBSyxVQUFMLEdBQWtCLEtBQUssT0FBTCxDQUFhLEtBQUssS0FBbEIsQ0FBbEI7QUFDQSxjQUFLLFVBQUwsQ0FBZ0IsRUFBaEIsQ0FBbUIsU0FBbkIsRUFBOEIsS0FBSyxTQUFuQztBQUNBLGNBQUssVUFBTCxDQUFnQixFQUFoQixDQUFtQixPQUFuQixFQUE0QixLQUFLLE9BQWpDO0FBQ0Y7OztvQ0FFYztBQUNaLGdCQUFPLEtBQUssVUFBTCxDQUFnQixTQUF2QjtBQUNGOzs7a0NBRVk7QUFDVixhQUFJLElBQUosQ0FBUyxXQUFUO0FBQ0EsY0FBSyxVQUFMLENBQWdCLE9BQWhCLENBQXdCLEtBQUssS0FBN0IsRUFBb0MsS0FBSyxPQUF6QztBQUNBLGNBQUssT0FBTDtBQUNGOzs7OEJBRVEsSyxFQUFPO0FBQ2IsYUFBSSxJQUFKLGVBQXFCLEtBQXJCO0FBQ0EsY0FBSyxNQUFMLENBQVksS0FBWjtBQUNGOzs7OEJBRVEsSyxFQUFPLE8sRUFBUztBQUFBOztBQUN0QixhQUFJLElBQUosQ0FBUyxTQUFUO0FBQ0EsZ0JBQU8sSUFBSSxPQUFKLENBQVksVUFBQyxPQUFELEVBQVUsTUFBVixFQUFxQjtBQUNyQyxrQkFBSyxPQUFMLEdBQWUsT0FBZjtBQUNBLGtCQUFLLE1BQUwsR0FBYSxNQUFiO0FBQ0Esa0JBQUssS0FBTCxHQUFhLEtBQWI7QUFDQSxrQkFBSyxPQUFMLEdBQWUsT0FBZjtBQUNBLGtCQUFLLE9BQUw7QUFDRixVQU5NLENBQVA7QUFPRjs7Ozs7O0FBR0osT0FBTyxPQUFQLEdBQWlCLFFBQWpCIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qKlxuICogQGZpbGVcbiAqIEBjb3B5cmlnaHRcbiAqIEBsaWNlbnNlXG4gKlxuICovXG4vKiBlc2xpbnQgdmFsaWQtanNkb2M6IFtcImVycm9yXCIsIHtcInJlcXVpcmVSZXR1cm5EZXNjcmlwdGlvblwiOiBmYWxzZX1dICovXG5cbi8vIGltcG9ydCBVc2VyIGZyb20gJy4vVXNlcic7XG4vLyBpbXBvcnQgUHJvamVjdCBmcm9tICcuL1Byb2plY3QnO1xuLy8gaW1wb3J0IEluc3RhbmNlIGZyb20gJy4vSW5zdGFuY2UnO1xudmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0JylcbnZhciBidW55YW4gPSByZXF1aXJlKCdidW55YW4nKVxuXG52YXIgbG9nID0gYnVueWFuLmNyZWF0ZUxvZ2dlcih7bmFtZTonV2lQdWJTdWInfSlcbi8vIHZhciBtcXR0Q2xpZW50XG5cbi8qKlxuICogV2lQdWJTdWIgZW5jYXBzdWxhdGVzIHRoZSBmdW5jdGlvbmFsaXR5IHRvIGNyZWF0ZSB2YXJpb3VzIEFQSSB3cmFwcGVyIG9iamVjdHMuXG4gKi9cbmNsYXNzIFdpUHViU3ViIHtcbiAgIC8qKlxuICAgICogQ3JlYXRlIGEgbmV3IFdpUHViU3ViLlxuICAgICovXG4gICBjb25zdHJ1Y3Rvcihob3N0ID0gJ3doYXRzaXQtcHVic3ViJywgcHJvdG9jb2wgPSAnbXF0dCcsIHBvcnQgPSAnMTg4MycpIHtcbiAgICAgIHRoaXMuX191cmwgPSBgJHtwcm90b2NvbH06Ly8ke2hvc3R9YFxuICAgICAgdGhpcy5fdGhpcyA9IHRoaXNcbiAgICAgIHRoaXMub25Db25uZWN0ID0gdGhpcy5vbkNvbm5lY3QuYmluZCh0aGlzKTtcbiAgICAgIHRoaXMub25FcnJvciA9IHRoaXMub25FcnJvci5iaW5kKHRoaXMpO1xuICAgfVxuXG4gICBjb25uZWN0ICgpIHtcbiAgICAgIHRoaXMubXF0dENsaWVudCA9IG1xdHQuY29ubmVjdCh0aGlzLl9fdXJsKVxuICAgICAgdGhpcy5tcXR0Q2xpZW50Lm9uKCdjb25uZWN0JywgdGhpcy5vbkNvbm5lY3QpO1xuICAgICAgdGhpcy5tcXR0Q2xpZW50Lm9uKCdlcnJvcicsIHRoaXMub25FcnJvcik7XG4gICB9XG5cbiAgIGlzQ29ubmVjdGVkICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1xdHRDbGllbnQuY29ubmVjdGVkO1xuICAgfVxuXG4gICBvbkNvbm5lY3QgKCkge1xuICAgICAgbG9nLmluZm8oJ29uQ29ubmVjdCcpXG4gICAgICB0aGlzLm1xdHRDbGllbnQucHVibGlzaCh0aGlzLnRvcGljLCB0aGlzLm1lc3NhZ2UpXG4gICAgICB0aGlzLnJlc29sdmUoKVxuICAgfVxuXG4gICBvbkVycm9yIChlcnJvcikge1xuICAgICAgbG9nLmluZm8oYG9uRXJyb3I6ICR7ZXJyb3J9YClcbiAgICAgIHRoaXMucmVqZWN0KGVycm9yKVxuICAgfVxuXG4gICBwdWJsaXNoICh0b3BpYywgbWVzc2FnZSkge1xuICAgICAgbG9nLmluZm8oJ3B1Ymxpc2gnKVxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgIHRoaXMucmVzb2x2ZSA9IHJlc29sdmVcbiAgICAgICAgIHRoaXMucmVqZWN0PSByZWplY3RcbiAgICAgICAgIHRoaXMudG9waWMgPSB0b3BpY1xuICAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZVxuICAgICAgICAgdGhpcy5jb25uZWN0KClcbiAgICAgIH0pXG4gICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gV2lQdWJTdWI7XG4iXX0="}